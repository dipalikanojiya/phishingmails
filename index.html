<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KES Free WiFi — Quick Access</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root{--card-radius:14px}
    body{font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:#f8fafc}
    .card{border-radius:var(--card-radius)}
    .brand{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#0ea5a4,#2563eb);display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .muted-small{font-size:.85rem;color:#6b7280}
    .overlay-debrief{position:fixed;inset:0;background:rgba(2,6,23,0.7);display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}
    .debrief-card{max-width:800px;width:100%;border-radius:12px}
  </style>

  <!-- Optional Google Analytics (can remove if not needed) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8SSWEXDVN7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-8SSWEXDVN7');
  </script>
</head>
<body>
  <main class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-body p-4">
            <div class="d-flex align-items-center gap-3 mb-3">
              <div class="brand">KES</div>
              <div>
                <h4 class="mb-0">Free KES Wi-Fi — Quick Access</h4>
                <p class="muted-small mb-0">Connect in seconds — one-time verification required.</p>
              </div>
            </div>

            <p class="text-muted">To provide temporary Wi-Fi access on campus, please verify a few details. This page may be part of a security training exercise — submit only if you are comfortable.</p>

            <form id="accessForm" class="mt-3" novalidate>
              <div class="row g-2">
                <div class="col-md-6 mb-3">
                  <label for="fullname" class="form-label">Full name</label>
                  <input id="fullname" name="fullname" class="form-control" type="text" placeholder="e.g. Dipali Kanojiya" required autofocus>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="email_input" class="form-label">Email</label>
                  <input id="email_input" name="email_input" class="form-control" type="email" placeholder="you@college.edu" required>
                </div>
              </div>

              <div class="mb-3">
                <label for="reason" class="form-label">Purpose</label>
                <select id="reason" name="reason" class="form-select">
                  <option>Study / Classes</option>
                  <option>Research</option>
                  <option>Guest access</option>
                  <option>Other</option>
                </select>
              </div>

              <div class="mb-3 form-check">
                <input id="terms" class="form-check-input" type="checkbox" required>
                <label for="terms" class="form-check-label">I confirm these details are mine. (This site may be used for training.)</label>
              </div>

              <div class="d-flex justify-content-between align-items-center">
                <button id="submitBtn" class="btn btn-primary" type="submit">Get Access</button>
              </div>
            </form>

            <hr>
            <p class="small text-muted mt-3">
              If this looks suspicious, do not enter your usual password anywhere and report it to 
              <a href="mailto:kesc344@gmail.com">kesc344@gmail.com</a>.
            </p>
          </div>
        </div>

        <div class="text-center mt-3 muted-small">© KES Shroff College — IT & Security</div>
      </div>
    </div>
  </main>

  <!-- Debrief Overlay -->
  <div id="debrief" class="overlay-debrief" style="display:none;">
    <div class="card debrief-card shadow-lg p-4 bg-white">
      <div class="card-body">
        <h4 class="mb-2">This was a simulated phishing exercise</h4>
        <p class="muted-small">You just completed a training simulation designed to help you spot realistic-looking scams. No real credentials were collected.</p>

        <hr>
        <h6>Why this page looked convincing</h6>
        <ul>
          <li>It used campus branding and a convenient offer (free Wi-Fi).</li>
          <li>It asked for familiar details (name, ID).</li>
          <li>There were no spelling or domain mismatches.</li>
        </ul>

        <h6>Red flags to watch for</h6>
        <ul>
          <li>Unexpected emails offering quick rewards or access.</li>
          <li>Requests for passwords or sensitive data on unknown pages.</li>
          <li>Links that don’t match official domains — hover to check.</li>
        </ul>

        <div class="d-flex gap-2 mt-3">
          <button id="quizBtn" class="btn btn-primary btn-sm">Take quick quiz</button>
          <button id="closeDebrief" class="btn btn-outline-secondary btn-sm">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ------------ CONFIG ------------
    const BACKEND_BASE = 'http://127.0.0.1:5000'; // Local Flask backend
    const params = new URLSearchParams(window.location.search);
    const email = params.get('email') || '';
    const cid = params.get('cid') || '';

    // ------------ TRACK CLICK ON PAGE LOAD ------------
    async function trackClick() {
      if (!cid || !email) return;
      try {
        await fetch(`${BACKEND_BASE}/track/${cid}/${email}`);
        console.log('Click tracked successfully');
      } catch (e) {
        console.warn('Error tracking click:', e);
      }
    }
    trackClick();

    // ------------ FORM SUBMIT (Show Debrief Only) ------------
    document.getElementById('accessForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if(!document.getElementById('terms').checked){
        alert('Please confirm the declaration.');
        return;
      }
      document.getElementById('debrief').style.display = 'flex';
    });

    document.getElementById('closeDebrief').addEventListener('click', function(){
      document.getElementById('debrief').style.display='none';
    });

    // ------------ SIMPLE QUIZ ------------
    document.getElementById('quizBtn').addEventListener('click', function(){
      const body = document.querySelector('#debrief .card-body');
      body.innerHTML = `
        <h4>Quick Phishing Awareness Quiz</h4>
        <p class="muted-small">Test your knowledge!</p>
        <form id="quizForm">
          <div class="mb-3">
            <label>1️⃣ What is a sign of phishing?</label><br>
            <input type="radio" name="q1" value="a"> Unknown sender with urgent message<br>
            <input type="radio" name="q1" value="b"> Official domain<br>
          </div>
          <div class="mb-3">
            <label>2️⃣ If you suspect phishing?</label><br>
            <input type="radio" name="q2" value="a"> Report to IT/security<br>
            <input type="radio" name="q2" value="b"> Click anyway<br>
          </div>
          <button class="btn btn-primary btn-sm">Submit</button>
        </form>
      `;
      document.getElementById('quizForm').addEventListener('submit', (ev)=>{
        ev.preventDefault();
        const answers = { q1: 'a', q2: 'a' };
        let score = 0;
        for (let q in answers){
          const selected = document.querySelector(`input[name="${q}"]:checked`);
          if (selected && selected.value === answers[q]) score++;
        }
        const total = Object.keys(answers).length;
        body.innerHTML = `
          <h4>Your Score: ${score}/${total}</h4>
          <p class="muted-small">${score === total ? 'Excellent!' : 'Good try! Stay alert for phishing clues.'}</p>
          <button id="closeQuiz" class="btn btn-outline-secondary btn-sm mt-3">Close</button>
        `;
        document.getElementById('closeQuiz').addEventListener('click', ()=> {
          document.getElementById('debrief').style.display='none';
        });
      });
    });
  </script>
</body>
</html>
