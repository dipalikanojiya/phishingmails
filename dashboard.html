<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhishAware | Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body { background:#f5f7fa; font-family:'Segoe UI',sans-serif; }
    .sidebar { width:240px; height:100vh; position:fixed; left:0; top:0;
      background:linear-gradient(180deg,#1e1e2f,#343a40); color:white; padding:20px 0; }
    .sidebar a { color:#ccc; display:block; padding:12px 25px; text-decoration:none;
      border-radius:8px; margin:5px 15px; }
    .sidebar a.active, .sidebar a:hover { background:#0d6efd; color:white; }
    .topbar { background:white; position:fixed; left:240px; right:0; top:0; padding:15px 30px;
      display:flex; justify-content:space-between; align-items:center;
      box-shadow:0 2px 8px rgba(0,0,0,0.05); }
    .content { margin-left:240px; margin-top:80px; padding:25px; }
    .card { border:none; border-radius:16px; box-shadow:0 4px 10px rgba(0,0,0,0.08); }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h3 class="text-center mb-4"><i class="fa-solid fa-shield-halved"></i> PhishAware</h3>
    <a href="/" class="active"><i class="fa-solid fa-gauge"></i> Dashboard</a>
    <a href="/campaign"><i class="fa-solid fa-envelope"></i> Campaigns</a>
    <a href="/report"><i class="fa-solid fa-chart-pie"></i> Reports</a>
  </div>

  <!-- Topbar -->
  <div class="topbar">
    <h5 class="fw-semibold mb-0"><i class="fa-solid fa-house me-2 text-primary"></i> Dashboard Overview</h5>
    <div><i class="fa-solid fa-user"></i> Admin</div>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="card text-center p-4">
          <h6 class="text-muted">Emails Sent</h6>
          <h2>{{ total_sent }}</h2>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center p-4">
          <h6 class="text-muted">Accessed</h6>
          <h2>{{ total_submitted }}</h2>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center p-4">
          <h6 class="text-muted">Clicked Links</h6>
          <h2>{{ total_clicked }}</h2>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center p-4">
          <h6 class="text-muted">Reported</h6>
          <h2>{{ total_reported }}</h2>
        </div>
      </div>
      <div class="col-md-3 mt-3">
        <div class="card text-center p-4">
          <h6 class="text-muted">Ignored</h6>
          <h2>{{ total_ignored }}</h2>
        </div>
      </div>
    </div>

    <!-- Campaign Summary Chart -->
    <div class="card p-4 mb-4">
      <h5 class="mb-3"><i class="fa-solid fa-chart-line me-2 text-primary"></i> Campaign Summary</h5>
      <canvas id="campaignChart" height="100"></canvas>
    </div>

    <!-- Campaign Details Table -->
    <div class="card p-4">
      <h5 class="mb-3"><i class="fa-solid fa-list me-2 text-primary"></i> Campaign Details</h5>
      <table class="table table-striped align-middle text-center">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Status</th>
            <th>Sent</th>
            <th>Accessed</th>
            <th>Clicked</th>
            <th>Reported</th>
            <th>Success %</th>
          </tr>
        </thead>
        <tbody>
          {% for c in campaigns %}
          <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.name }}</td>
            <td>{{ c.status }}</td>
            <td>{{ c.emails_sent }}</td>
            <td>{{ c.submitted or 0 }}</td>
            <td>{{ c.clicked or 0 }}</td>
            <td>{{ c.reported or 0 }}</td>
            <td>{{ "%.1f"|format(c.success_rate) }}%</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted">No campaigns yet</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    new Chart(document.getElementById('campaignChart'), {
      type: 'doughnut',
      data: {
        labels: ['Accessed', 'Clicked', 'Reported', 'Ignored'],
        datasets: [{
          data: [{{ total_submitted }}, {{ total_clicked }}, {{ total_reported }}, {{ total_ignored }}],
          backgroundColor: ['#4bc0c0', '#ff6384', '#36a2eb', '#cccccc']
        }]
      },
      options: {
        plugins: { legend: { position: 'bottom' } }
      }
    });
  </script>

</body>
</html>
