<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>PhishAware | Reports</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {background:#f5f7fa;font-family:'Segoe UI',sans-serif;}
    .sidebar {width:240px;position:fixed;height:100vh;background:linear-gradient(180deg,#1e1e2f,#343a40);color:white;padding-top:20px;}
    .sidebar a {display:block;text-decoration:none;color:#ccc;padding:10px 25px;margin:4px 15px;border-radius:6px;}
    .sidebar a.active, .sidebar a:hover {background:#0d6efd;color:white;}
    .content {margin-left:240px;padding:30px;}
    .chart-card {border:none;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h3 class="text-center mb-4"><i class="fa-solid fa-shield-halved"></i> PhishAware</h3>
    <a href="/">Dashboard</a>
    <a href="/campaign">Campaigns</a>
    <a href="/report" class="active">Reports</a>
  </div>

  <!-- Main Content -->
  <div class="content">
    <h3 class="mb-4"><i class="fa-solid fa-chart-pie text-primary me-2"></i>Campaign Reports</h3>

    <!-- Table Section -->
    <div class="card p-4 shadow-sm mb-5">
      <div class="table-responsive">
        <table class="table table-striped text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Campaign Name</th>
              <th>Emails Sent</th>
              <th>Clicked</th>
              <th>Submitted</th>
              <th>Reported</th>
              <th>Ignored</th>
              <th>Success Rate</th>
            </tr>
          </thead>
          <tbody>
            {% for c in campaigns %}
            <tr>
              <td>{{ c.name }}</td>
              <td>{{ c.emails_sent or 0 }}</td>
              <td class="text-danger fw-bold">{{ c.clicked_count or 0 }}</td>
              <td class="text-warning fw-bold">{{ c.submitted_count or 0 }}</td>
              <td class="text-success fw-bold">{{ c.reported_count or 0 }}</td>
              <td>
                {{ (c.emails_sent - ((c.clicked_count or 0) + (c.submitted_count or 0) + (c.reported_count or 0))) if c.emails_sent else 0 }}
              </td>
              <td><span class="badge bg-primary">{{ "%.1f"|format(c.success_rate or 0) }}%</span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Chart Section -->
    <h5 class="mb-3"><i class="fa-solid fa-chart-column text-primary me-2"></i>Visual Breakdown</h5>
    <div class="row g-4">
      {% for c in campaigns %}
      <div class="col-md-6 col-lg-4">
        <div class="card p-4 chart-card">
          <h6 class="fw-bold text-primary mb-2"><i class="fa-solid fa-envelope me-2"></i>{{ c.name }}</h6>
          <p class="text-muted mb-3 small">Status: {{ c.status }} | Sent: {{ c.emails_sent }}</p>
          <canvas id="chart{{ c.id }}" height="120"></canvas>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    {% for c in campaigns %}
      new Chart(document.getElementById('chart{{ c.id }}'), {
        type: 'doughnut',
        data: {
          labels: ['Clicked', 'Submitted', 'Reported', 'Ignored'],
          datasets: [{
            data: [
              {{ c.clicked_count or 0 }},
              {{ c.submitted_count or 0 }},
              {{ c.reported_count or 0 }},
              {{ (c.emails_sent - ((c.clicked_count or 0) + (c.submitted_count or 0) + (c.reported_count or 0))) if c.emails_sent else 0 }}
            ],
            backgroundColor: ['#ff6384','#ffc107','#36a2eb','#cccccc']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom' },
            title: { display: true, text: '{{ c.name }}', font: { size: 14 } }
          }
        }
      });
    {% endfor %}
  </script>
</body>
</html>
